#!/bin/sh

FACTORS="1 2"
CONFIGS="1:1:1 1:1:2 1:1:4 1:2:3 2:1:1 2:1:4"

portOffset=150

for factor in $FACTORS; do
    for config in $CONFIGS; do
        name=$factor:$config
        portOffset=$(expr $portOffset + 50)
        pathname=$(echo $name | sed -e 's/:/_/g')

        echo $name
        echo factor=$factor
        echo portOffset=$portOffset
        cat > conf/peregrine-test-$name.py <<EOF

## AUTOGENERATED.  DO NOT EDIT.
SCRATCH="/tmp/integration/test-$pathname"

TEST_LOGS="/var/lib/integration/peregrine/test-$pathname"

TEST_COMMAND="export HOSTNAME=localhost && export ANT_OPTS='-Xmx512M -Dperegrine.test.portOffset=$portOffset -Dmulti.factors=$factor -Dmulti.configs=$config' && time ant test"

POST_COMMAND="export ANT_OPTS=-Xmx512M && ant test-report"

REPO="https://burtonator:redapplekittycat@bitbucket.org/burtonator/peregrine"

OUTPUT = { 'test-reports' : 'target/test-reports'  }

OLD_AGE=12 * 60 * 60

TIMEOUT=30*60

EOF

    echo $tmpl

    done
done


